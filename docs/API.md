**æ–‡ä»¶è¯´æ˜**ï¼šåç«¯æ¥å£æ–‡æ¡£ï¼Œæè¿°äº†å‰ç«¯å¦‚ä½•ä¸åç«¯äº¤äº’ï¼Œä»¥åŠç¬¬ä¸‰æ–¹åº”ç”¨å¦‚ä½•è°ƒç”¨è®¢é˜…ã€‚

# ğŸ“¡ API æ¥å£æ–‡æ¡£

æ‰€æœ‰ API å‡åŸºäº HTTP/1.1ï¼Œå“åº”æ ¼å¼é»˜è®¤ä¸º JSONã€‚

## ğŸ”‘ è®¤è¯ä¸æ‰«ç 

### 1. ç”ŸæˆäºŒç»´ç 
- **URL**: `GET /api/qr/generate`
- **æè¿°**: åˆå§‹åŒ–ç™»å½•ä¼šè¯ï¼Œè·å–äºŒç»´ç å›¾ç‰‡ã€‚
- **å“åº”**:
  ```json
  {
    "success": true,
    "qrCodeId": "1732...",
    "imageData": "Base64å­—ç¬¦ä¸²..."
  }
  ```

- Cookie: è®¾ç½® session_id (HttpOnly)ã€‚

### 2. è½®è¯¢äºŒç»´ç çŠ¶æ€
- **URL**: `POST /api/qr/status`
- **Body**: `{ "qrCodeId": "..." }`
- **æè¿°: æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ‰«ç æˆ–ç¡®è®¤ã€‚**
- **å“åº”:**
  - `status: "0"` - ç­‰å¾…æ‰«ç 
  - `status: "2"` - å·²æ‰«ç ï¼Œç­‰å¾…ç¡®è®¤
  - `status: "3"` - ç™»å½•æˆåŠŸ (è¿”å› `stateKey`)
  - `status: "4"` - ç”¨æˆ·å–æ¶ˆ

### 3. å®Œæˆç™»å½•
- **URL:** `POST /api/qr/login`
- **Body:**
  ```json
  {
    "qrCodeId": "...",
    "stateKey": "...",
    "semester_start": "2025-09-08"
  }
  ```
- **æè¿°: ä½¿ç”¨ stateKey æ¢å–æœ€ç»ˆçš„è®¢é˜… Tokenã€‚**
- **å“åº”:**
  ```json
  {
    "success": true,
    "token": "UniqueSubscriptionToken...",
    "existing": false // å¦‚æœæ˜¯è€ç”¨æˆ·æ›´æ–°Cookieï¼Œæ­¤å­—æ®µä¸º true
  }
  ```
## ğŸ“… è®¢é˜…ä¸ç®¡ç†
### 4. è·å– ICS è®¢é˜…
- **URL:** `GET /schedule/:token`
- **æè¿°: è·å–æ—¥å†æ–‡ä»¶ã€‚**
- **Content-Type:** `text/calendar`
- **æ³¨æ„: å¦‚æœ Cookie å¤±æ•ˆï¼Œå°†è¿”å› 401 é”™è¯¯ï¼Œä¸”æ•°æ®åº“ä¸­æ ‡è®°è¯¥ Token æ— æ•ˆã€‚**

### 5. ä¸‹è½½ ICS æ–‡ä»¶
- **URL:** `GET /api/download/:token`
- **æè¿°: ç›´æ¥è§¦å‘æµè§ˆå™¨ä¸‹è½½ `.ics` æ–‡ä»¶ã€‚**

### 6. åˆ é™¤è´¦å·
- **URL:** `DELETE /api/user/:token`
- **æè¿°: ä»æ•°æ®åº“ä¸­å½»åº•åˆ é™¤ç”¨æˆ·æ•°æ®åŠè®¢é˜…é“¾æ¥ã€‚**

### 7. ç³»ç»Ÿç»Ÿè®¡
- **URL:**`GET /api/stats`
- **å“åº”:**
  ```json
  {
    "total_users": 100,
    "active_users": 80,
    "valid_cookies": 75
  }
  ```